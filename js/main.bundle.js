(()=>{"use strict";const e=document.querySelector("#card").content,t={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},o=document.querySelector("main"),r=document.querySelector("#error-data").content,n=function(e){const t=r.cloneNode(!0),n=t.querySelector(".error"),a=t.querySelector(".error__button");t.querySelector(".error__details")&&e&&(t.querySelector(".error__details").textContent=e),o.appendChild(t);const c=function(){n.classList.add("visually-hidden"),a.removeEventListener("click",d),n.removeEventListener("click",i),window.removeEventListener("keydown",s)},d=function(e){e.stopPropagation(),c()},i=function(){c()},s=function(e){"Escape"===e.code&&c()};a.addEventListener("click",d),n.addEventListener("click",i),window.addEventListener("keydown",s)},a=document.querySelector("#address"),c={lat:35.6895,lng:139.69171},d=L.map("map-canvas").setView(c,10),i=L.layerGroup().addTo(d);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(d);const s=L.icon({iconUrl:"./img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),u=L.icon({iconUrl:"./img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),l=L.marker(d.getCenter(),{draggable:!0,icon:s});l.addTo(d),l.on("moveend",(e=>{a.value=`${e.target.getLatLng().lat.toFixed(5)}, ${e.target.getLatLng().lng.toFixed(5)}`})),d.on("adv-form-submitted",(()=>{d.setView(c,10),l.setLatLng(c).fire("moveend")}));const p=function(o){o.forEach((o=>{const r=(o=>{const r=o.offer,n=e.cloneNode(!0);r.title?n.querySelector(".popup__title").textContent=r.title:n.querySelector(".popup__title").classList.add("hidden"),r.address?n.querySelector(".popup__text--address").textContent=r.address:n.querySelector(".popup__text--address").classList.add("hidden"),r.price?n.querySelector(".popup__text--price").textContent=`${r.price} ₽/ночь`:n.querySelector(".popup__text--price").classList.add("hidden"),r.type?n.querySelector(".popup__type").textContent=function(e){let o;if(!(e.type in t))throw new Error("Неизвестный тип предложения");return o=t[e.type],o}(r):n.querySelector(".popup__type").classList.add("hidden"),r.rooms&&r.guests?n.querySelector(".popup__text--capacity").textContent=`${r.rooms} комнаты для ${r.guests} гостей`:n.querySelector(".popup__text--capacity").classList.add("hidden"),r.checkin&&r.checkout?n.querySelector(".popup__text--time").textContent=`Заезд после ${r.checkin}, выезд до ${r.checkout}`:n.querySelector(".popup__text--time").classList.add("hidden"),r.features&&r.features.length>0?(n.querySelectorAll(".popup__feature").forEach((e=>{e.classList.add("hidden")})),r.features.forEach((e=>{n.querySelector(`.popup__feature--${e}`).classList.remove("hidden")}))):n.querySelector(".popup__features").classList.add("hidden"),r.description?n.querySelector(".popup__description").textContent=r.description:n.querySelector(".popup__description").classList.add("hidden");const a=n.querySelector(".popup__photos");return r.photos&&r.photos.length>0?(r.photos.forEach((e=>{let t=a.querySelector(".popup__photo").cloneNode(!0);t.setAttribute("src",e),a.appendChild(t)})),a.querySelector(".popup__photo").remove()):a.classList.add("hidden"),o.author&&o.author.avatar?n.querySelector(".popup__avatar").setAttribute("src",o.author.avatar):n.querySelector(".popup__avatar").classList.add("hidden"),n})(o),n=L.marker({lat:o.location.lat,lng:o.location.lng},{icon:u}),a=document.createElement("div");a.appendChild(r),n.bindPopup(a.innerHTML),o.pointerMarker=n})),d.fire("load-all-data",{rents:o})};d.addHandler("load",(function(){var e,t;a.setAttribute("readonly",""),a.value=`${l.getLatLng().lat.toFixed(5)}, ${l.getLatLng().lng.toFixed(5)}`,e=p,t=n,fetch("https://22.javascript.pages.academy/keksobooking/data",{method:"GET",credentials:"same-origin"}).then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((t=>{e(t)})).catch((e=>{t(e)}))}));const h=["gif","jpg","jpeg","png"],f=document.querySelector("main"),m=document.querySelector("#success").content,y=document.querySelector(".ad-form"),v=y.querySelectorAll("fieldset"),g=document.querySelector("#type"),S=document.querySelector("#price"),q=document.querySelector("#timein"),E=document.querySelector("#timeout"),b=document.querySelector("#room_number"),k=document.querySelector("#capacity"),w=document.querySelector(".ad-form__reset"),x=document.querySelector(".ad-form__field input[type=file]"),A=document.querySelector(".ad-form-header__preview img"),C=document.querySelector(".ad-form__upload input[type=file]"),$=document.querySelector(".ad-form__photo");g.addEventListener("change",(()=>{let e;"bungalow"===g.value?e=0:"flat"===g.value?e=1e3:"house"===g.value?e=5e3:"palace"===g.value&&(e=1e4),S.placeholder=e,S.setAttribute("min",e)})),q.addEventListener("change",(()=>{E.value=q.value})),E.addEventListener("change",(()=>{q.value=E.value})),d.addHandler("load",(function(){y.classList.remove("ad-form--disabled"),v.forEach((e=>{e.removeAttribute("disabled")})),A.setAttribute("data-default-src",A.src)}));const T=function(){let e="";const t=+b.value,o=+k.value;1===t?e=1===o?"":'Для 1 комнаты допустимое кол-во мест "для 1 гостя"':2===t?e=1===o||2===o?"":'Для 2 комнат допустимое кол-во мест "для 1 гостя" или "для 2 гостей"':3===t?e=1===o||2===o||3===o?"":'Для 3 комнат допустимое кол-во мест "для 1 гостя" или "для 2 гостей" или "для 3 гостей"':100===t&&(e=0===o?"":'Для 100 комнат допустимое кол-во мест "не для гостей"'),k.setCustomValidity(e)};T(),b.addEventListener("change",T),k.addEventListener("change",T);const j=function(){y.reset(),T(),d.fire("adv-form-submitted"),A.src=A.getAttribute("data-default-src"),$.style.backgroundImage=null},F=function(){const e=m.cloneNode(!0),t=e.querySelector(".success");f.appendChild(e);const o=function(){t.classList.add("visually-hidden"),t.removeEventListener("click",r),window.removeEventListener("keydown",n)},r=function(){o()},n=function(e){"Escape"===e.code&&o()};t.addEventListener("click",r),window.addEventListener("keydown",n),j()};y.addEventListener("submit",(e=>{var t,o;e.preventDefault(),t=F,o=n,fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",credentials:"same-origin",body:new FormData(y)}).then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((e=>{t(e)})).catch((e=>{o(e)}))})),w.addEventListener("click",(e=>{e.preventDefault(),j()}));const D=function(e,t){const o=e.files[0],r=o.name.toLowerCase();if(h.some((e=>r.endsWith(e)))){const e=new FileReader;e.readAsDataURL(o),e.addEventListener("load",(()=>{"src"in t?t.src=e.result:t.style.backgroundImage=`url(${e.result})`}))}};let M;x.addEventListener("change",(()=>{D(x,A)})),C.addEventListener("change",(()=>{D(C,$)}));const N=document.querySelector(".map__filters"),z=N.querySelectorAll(".map__filter, fieldset"),H=N.querySelector("#housing-type"),P=N.querySelector("#housing-price"),U=N.querySelector("#housing-rooms"),V=N.querySelector("#housing-guests"),G=N.querySelectorAll(".map__checkbox"),I="any",O=function(){let e=[];const t=+U.value,o=+V.value;for(let r=0;r<M.length;r++){const n=M[r],a=n.offer.features;let c=!0,d=n.offer.price;if(H.value===I||n.offer.type===H.value){if(P.value!==I){if("middle"===P.value&&(d<1e4||d>5e4))continue;if("low"===P.value&&d>=1e4)continue;if("high"===P.value&&d<=5e4)continue}if((U.value===I||n.offer.rooms===t)&&(V.value===I||n.offer.guests===o)&&(G.forEach((e=>{if(e.checked){let t=!1;a.forEach((o=>{o===e.value&&(t=!0)})),t||(c=!1)}})),c&&(e.push(n),e.length>=10)))break}}!function(e){i.clearLayers(),e.forEach((e=>{i.addLayer(e.pointerMarker)}))}(e)};d.on("load-all-data",(e=>{M=e.rents,N.classList.remove("map__filters--disabled"),z.forEach((e=>{e.removeAttribute("disabled")})),O()})),d.on("adv-form-submitted",(()=>{N.reset(),O()}));let R=_.debounce(O,500);H.addEventListener("change",R),P.addEventListener("change",R),U.addEventListener("change",R),V.addEventListener("change",R),G.forEach((e=>{e.addEventListener("change",R)}))})();
//# sourceMappingURL=main.bundle.js.map