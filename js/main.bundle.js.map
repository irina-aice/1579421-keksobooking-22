{"version":3,"sources":["webpack://keksobooking/./source/js/popup.js","webpack://keksobooking/./source/js/fetch.js","webpack://keksobooking/./source/js/map.js","webpack://keksobooking/./source/js/adv-form.js","webpack://keksobooking/./source/js/filter-form.js"],"names":["cardTemplate","document","querySelector","content","offerTypeValues","flat","bungalow","house","palace","main","errorTemplate","onFetchError","err","errorTemplateClone","cloneNode","errorBlock","errorButton","textContent","appendChild","closeErrorPopup","classList","add","removeEventListener","onErrorButtonClick","onErrorBlockClick","window","onErrorPopupEscKeydown","evt","stopPropagation","code","addEventListener","addressInput","mapCenterLatLng","lat","lng","map","L","setView","markers","layerGroup","addTo","tileLayer","attribution","mainPinIcon","icon","iconUrl","iconSize","iconAnchor","pinIcon","mainPinMarker","marker","getCenter","draggable","on","value","target","getLatLng","toFixed","setLatLng","fire","onFetchSuccess","rents","forEach","rent","popupHtml","offer","popupElement","title","address","price","type","offerTypeValue","Error","getOfferTypeLabel","rooms","guests","checkin","checkout","features","length","querySelectorAll","photoFeature","feature","remove","description","popupPhotos","photos","photo","popupPhoto","setAttribute","author","avatar","getRentPopup","pinMarker","location","helperDiv","createElement","bindPopup","innerHTML","pointerMarker","addHandler","onSuccess","onError","fetch","method","credentials","then","response","ok","json","status","statusText","catch","FILE_TYPES","successTemplate","formElements","typeSelect","priceInput","timeinSelect","timeoutSelect","roomNumberSelect","capacitySelect","resetButton","avatarFileChooser","avatarPreview","photoFileChooser","photoPreview","min","placeholder","formElement","removeAttribute","src","checkCapacity","customValidityMessage","roomNumberSelectValue","capacitySelectValue","setCustomValidity","resetForm","reset","getAttribute","style","backgroundImage","successTemplateClone","successBlock","closeSuccessPopup","onSuccessBlockClick","onSuccessPopupEscKeydown","preventDefault","body","FormData","onFilePreview","fileSelector","previewSelector","file","files","fileName","name","toLowerCase","some","it","endsWith","reader","FileReader","readAsDataURL","result","housingTypeSelect","housingPriceSelect","housingRoomsSelect","housingGuestsSelect","housingFeaturesCheckboxList","SELECT_ANY","filterCallback","filteredRents","housingRoomsValue","housingGuestsValue","i","isValidFeatures","checkbox","checked","isValidFeature","push","clearLayers","addLayer","renderMarkers","data","debouncedFilterCallback","_","debounce"],"mappings":"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","file":"main.bundle.js","sourcesContent":["const cardTemplate = document.querySelector('#card').content;\n\nconst offerTypeValues = {\n  flat: 'Квартира',\n  bungalow: 'Бунгало',\n  house: 'Дом',\n  palace: 'Дворец',\n};\n\nconst getOfferTypeLabel = function(offer) {\n  let offerTypeValue;\n\n  if (offer.type in offerTypeValues) {\n    offerTypeValue = offerTypeValues[offer.type];\n  } else {\n    throw new Error('Неизвестный тип предложения');\n  }\n\n  return offerTypeValue;\n}\n\nconst getRentPopup = (rent) => {\n  const offer = rent.offer;\n\n  const popupElement = cardTemplate.cloneNode(true);\n\n  if (offer.title) {\n    popupElement.querySelector('.popup__title').textContent = offer.title;\n  } else {\n    popupElement.querySelector('.popup__title').classList.add('hidden');\n  }\n\n  if (offer.address) {\n    popupElement.querySelector('.popup__text--address').textContent = offer.address;\n  } else {\n    popupElement.querySelector('.popup__text--address').classList.add('hidden');\n  }\n\n  if (offer.price) {\n    popupElement.querySelector('.popup__text--price').textContent = `${offer.price} ₽/ночь`;\n  } else {\n    popupElement.querySelector('.popup__text--price').classList.add('hidden');\n  }\n\n  if (offer.type) {\n    popupElement.querySelector('.popup__type').textContent = getOfferTypeLabel(offer);\n  } else {\n    popupElement.querySelector('.popup__type').classList.add('hidden');\n  }\n\n  if (offer.rooms && offer.guests) {\n    popupElement.querySelector('.popup__text--capacity').textContent = `${offer.rooms} комнаты для ${offer.guests} гостей`;\n  } else {\n    popupElement.querySelector('.popup__text--capacity').classList.add('hidden');\n  }\n\n  if (offer.checkin && offer.checkout) {\n    popupElement.querySelector('.popup__text--time').textContent = `Заезд после ${offer.checkin}, выезд до ${offer.checkout}`;\n  } else {\n    popupElement.querySelector('.popup__text--time').classList.add('hidden');\n  }\n\n  if (offer.features && offer.features.length > 0) {\n    popupElement.querySelectorAll('.popup__feature').forEach((photoFeature) => {\n      photoFeature.classList.add('hidden');\n    });\n\n    offer.features.forEach((feature) => {\n      popupElement.querySelector(`.popup__feature--${feature}`).classList.remove('hidden');\n    });\n  } else {\n    popupElement.querySelector('.popup__features').classList.add('hidden');\n  }\n\n  if (offer.description) {\n    popupElement.querySelector('.popup__description').textContent = offer.description;\n  } else {\n    popupElement.querySelector('.popup__description').classList.add('hidden');\n  }\n\n  const popupPhotos = popupElement.querySelector('.popup__photos');\n\n  if (offer.photos && offer.photos.length > 0) {\n    offer.photos.forEach((photo) => {\n      let popupPhoto = popupPhotos.querySelector('.popup__photo').cloneNode(true);\n\n      popupPhoto.setAttribute('src', photo);\n\n      popupPhotos.appendChild(popupPhoto);\n    });\n\n    popupPhotos.querySelector('.popup__photo').remove();\n  } else {\n    popupPhotos.classList.add('hidden');\n  }\n\n  if (rent.author && rent.author.avatar) {\n    popupElement.querySelector('.popup__avatar').setAttribute('src', rent.author.avatar);\n  } else {\n    popupElement.querySelector('.popup__avatar').classList.add('hidden');\n  }\n\n  return popupElement;\n}\n\nexport {getRentPopup};\n","const main = document.querySelector('main');\nconst errorTemplate = document.querySelector('#error-data').content;\n\nconst fetchMapData = (onSuccess, onError) => {\n  return fetch(\n    'https://22.javascript.pages.academy/keksobooking/data',\n    {\n      method: 'GET',\n      credentials: 'same-origin',\n    },\n  )\n    .then((response) => {\n      if (response.ok) {\n        return response.json();\n      }\n\n      throw new Error(`${response.status} ${response.statusText}`);\n    })\n    .then((json) => {\n      onSuccess(json);\n    })\n    .catch((err) => {\n      onError(err);\n    });\n};\n\nconst sendAdvForm = (onSuccess, onError, formData) => {\n  return fetch(\n    'https://22.javascript.pages.academy/keksobooking',\n    {\n      method: 'POST',\n      credentials: 'same-origin',\n      body: new FormData(formData),\n    },\n  )\n    .then((response) => {\n      if (response.ok) {\n        return response.json();\n      }\n\n      throw new Error(`${response.status} ${response.statusText}`);\n    })\n    .then((json) => {\n      onSuccess(json);\n    })\n    .catch((err) => {\n      onError(err);\n    });\n};\n\nconst onFetchError = function (err) {\n  const errorTemplateClone = errorTemplate.cloneNode(true);\n  const errorBlock = errorTemplateClone.querySelector('.error');\n  const errorButton = errorTemplateClone.querySelector('.error__button');\n  const errorDetails =  errorTemplateClone.querySelector('.error__details');\n\n  if (errorDetails && err) {\n    errorTemplateClone.querySelector('.error__details').textContent = err;\n  }\n\n  main.appendChild(errorTemplateClone);\n\n  const closeErrorPopup = function () {\n    errorBlock.classList.add('visually-hidden');\n\n    errorButton.removeEventListener('click', onErrorButtonClick);\n    errorBlock.removeEventListener('click', onErrorBlockClick);\n    window.removeEventListener('keydown', onErrorPopupEscKeydown);\n  }\n\n  const onErrorButtonClick = function (evt) {\n    evt.stopPropagation();\n\n    closeErrorPopup();\n  }\n\n  const onErrorBlockClick = function () {\n    closeErrorPopup();\n  }\n\n  const onErrorPopupEscKeydown = function (evt) {\n    if (evt.code === 'Escape') {\n      closeErrorPopup();\n    }\n  }\n\n  errorButton.addEventListener('click', onErrorButtonClick);\n  errorBlock.addEventListener('click', onErrorBlockClick);\n  window.addEventListener('keydown', onErrorPopupEscKeydown);\n}\n\n\nexport {fetchMapData, sendAdvForm, onFetchError};\n","/* global L:readonly */\nimport {getRentPopup} from './popup.js';\nimport {fetchMapData, onFetchError} from './fetch.js';\n\nconst addressInput = document.querySelector('#address');\nconst mapCenterLatLng = {\n  lat: 35.6895000,\n  lng: 139.6917100,\n};\n\nconst map = L.map('map-canvas')\n  .setView(mapCenterLatLng, 10);\n\nconst markers = L.layerGroup().addTo(map);\n\nL.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n  {\n    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n  },\n).addTo(map);\n\nconst mainPinIcon = L.icon({\n  iconUrl: './img/main-pin.svg',\n  iconSize: [52, 52],\n  iconAnchor: [26, 52],\n});\n\nconst pinIcon = L.icon({\n  iconUrl: './img/pin.svg',\n  iconSize: [40, 40],\n  iconAnchor: [20, 40],\n});\n\nconst mainPinMarker = L.marker(\n  map.getCenter(),\n  {\n    draggable: true,\n    icon: mainPinIcon,\n  },\n);\n\nmainPinMarker.addTo(map);\n\nmainPinMarker.on('moveend', (evt) => {\n  addressInput.value = `${evt.target.getLatLng().lat.toFixed(5)}, ${evt.target.getLatLng().lng.toFixed(5)}`;\n});\n\nmap.on('adv-form-submitted', () => {\n  map.setView(mapCenterLatLng, 10);\n  mainPinMarker.setLatLng(mapCenterLatLng).fire('moveend');\n});\n\nconst renderMarkers = function (rents) {\n  markers.clearLayers();\n\n  rents.forEach((rent) => {\n    markers.addLayer(rent.pointerMarker);\n  })\n}\n\nconst onFetchSuccess = function (rents) {\n  rents.forEach((rent) => {\n    const popupHtml = getRentPopup(rent, true);\n\n    const pinMarker = L.marker(\n      {\n        lat: rent.location.lat,\n        lng: rent.location.lng,\n      },\n      {\n        icon: pinIcon,\n      });\n\n    const helperDiv = document.createElement('div');\n    helperDiv.appendChild(popupHtml);\n\n    pinMarker.bindPopup(helperDiv.innerHTML);\n\n    rent.pointerMarker = pinMarker;\n  })\n\n  map.fire('load-all-data', {rents: rents});\n};\n\nmap.addHandler('load', function () {\n  addressInput.setAttribute('readonly', '');\n  addressInput.value = `${mainPinMarker.getLatLng().lat.toFixed(5)}, ${mainPinMarker.getLatLng().lng.toFixed(5)}`;\n\n  fetchMapData(onFetchSuccess, onFetchError);\n});\n\nexport {map, renderMarkers};\n","import {map} from './map.js';\nimport {sendAdvForm, onFetchError} from './fetch.js';\n\nconst FILE_TYPES = ['gif', 'jpg', 'jpeg', 'png'];\n\nconst roomNumberValues = {\n  one: 1,\n  two: 2,\n  three: 3,\n  hundred: 100,\n};\n\nconst capacityValues = {\n  zero: 0,\n  one: 1,\n  two: 2,\n  three: 3,\n};\n\nconst typeSelectValues = {\n  bungalow: 0,\n  flat: 1000,\n  house: 5000,\n  palace: 10000,\n}\n\nconst main = document.querySelector('main');\nconst successTemplate = document.querySelector('#success').content;\nconst form = document.querySelector('.ad-form');\nconst formElements = form.querySelectorAll('fieldset');\nconst typeSelect = document.querySelector('#type');\nconst priceInput = document.querySelector('#price');\nconst timeinSelect = document.querySelector('#timein');\nconst timeoutSelect = document.querySelector('#timeout');\nconst roomNumberSelect = document.querySelector('#room_number');\nconst capacitySelect = document.querySelector('#capacity');\nconst resetButton = document.querySelector('.ad-form__reset');\nconst avatarFileChooser = document.querySelector('.ad-form__field input[type=file]');\nconst avatarPreview = document.querySelector('.ad-form-header__preview img');\nconst photoFileChooser = document.querySelector('.ad-form__upload input[type=file]');\nconst photoPreview = document.querySelector('.ad-form__photo');\n\ntypeSelect.addEventListener('change', () => {\n  let min;\n\n  if (typeSelect.value === 'bungalow') {\n    min = typeSelectValues.bungalow;\n  } else if (typeSelect.value === 'flat') {\n    min = typeSelectValues.flat;\n  } else if (typeSelect.value === 'house') {\n    min = typeSelectValues.house;\n  } else if (typeSelect.value === 'palace') {\n    min = typeSelectValues.palace;\n  }\n\n  priceInput.placeholder = min;\n  priceInput.setAttribute('min', min);\n});\n\ntimeinSelect.addEventListener('change', () => {\n  timeoutSelect.value = timeinSelect.value;\n});\n\ntimeoutSelect.addEventListener('change', () => {\n  timeinSelect.value = timeoutSelect.value;\n});\n\nmap.addHandler('load', function () {\n  form.classList.remove('ad-form--disabled');\n\n  formElements.forEach((formElement) => {\n    formElement.removeAttribute('disabled');\n  });\n\n  avatarPreview.setAttribute('data-default-src', avatarPreview.src);\n});\n\nconst checkCapacity = function () {\n  let customValidityMessage = '';\n\n  const roomNumberSelectValue = +roomNumberSelect.value;\n  const capacitySelectValue = +capacitySelect.value;\n\n  if (roomNumberSelectValue === roomNumberValues.one) {\n    if (capacitySelectValue === capacityValues.one) {\n      customValidityMessage = '';\n    } else {\n      customValidityMessage = 'Для 1 комнаты допустимое кол-во мест \"для 1 гостя\"';\n    }\n  } else if (roomNumberSelectValue === roomNumberValues.two) {\n    if (capacitySelectValue === capacityValues.one || capacitySelectValue === capacityValues.two) {\n      customValidityMessage = '';\n    } else {\n      customValidityMessage = 'Для 2 комнат допустимое кол-во мест \"для 1 гостя\" или \"для 2 гостей\"';\n    }\n  } else if (roomNumberSelectValue === roomNumberValues.three) {\n    if (capacitySelectValue === capacityValues.one || capacitySelectValue === capacityValues.two || capacitySelectValue === capacityValues.three) {\n      customValidityMessage = '';\n    } else {\n      customValidityMessage = 'Для 3 комнат допустимое кол-во мест \"для 1 гостя\" или \"для 2 гостей\" или \"для 3 гостей\"';\n    }\n  } else if (roomNumberSelectValue === roomNumberValues.hundred) {\n    if (capacitySelectValue === capacityValues.zero) {\n      customValidityMessage = '';\n    } else {\n      customValidityMessage = 'Для 100 комнат допустимое кол-во мест \"не для гостей\"';\n    }\n  }\n\n  capacitySelect.setCustomValidity(customValidityMessage);\n}\n\ncheckCapacity();\n\nroomNumberSelect.addEventListener('change', checkCapacity);\ncapacitySelect.addEventListener('change', checkCapacity);\n\nconst resetForm = function () {\n  form.reset();\n  checkCapacity();\n  map.fire('adv-form-submitted');\n\n  avatarPreview.src = avatarPreview.getAttribute('data-default-src');\n  photoPreview.style.backgroundImage = null;\n}\n\nconst onFetchSuccess = function () {\n  const successTemplateClone = successTemplate.cloneNode(true);\n  const successBlock = successTemplateClone.querySelector('.success');\n\n  main.appendChild(successTemplateClone);\n\n  const closeSuccessPopup = function () {\n    successBlock.classList.add('visually-hidden');\n\n    successBlock.removeEventListener('click', onSuccessBlockClick);\n    window.removeEventListener('keydown', onSuccessPopupEscKeydown);\n  }\n\n  const onSuccessBlockClick = function () {\n    closeSuccessPopup();\n  }\n\n  const onSuccessPopupEscKeydown = function (evt) {\n    if (evt.code === 'Escape') {\n      closeSuccessPopup();\n    }\n  }\n\n  successBlock.addEventListener('click', onSuccessBlockClick);\n  window.addEventListener('keydown', onSuccessPopupEscKeydown);\n\n  resetForm();\n};\n\nform.addEventListener('submit', (evt) => {\n  evt.preventDefault();\n\n  sendAdvForm(onFetchSuccess, onFetchError, form);\n});\n\nresetButton.addEventListener('click', (evt) => {\n  evt.preventDefault();\n\n  resetForm();\n});\n\nconst onFilePreview = function (fileSelector, previewSelector) {\n  const file = fileSelector.files[0];\n  const fileName = file.name.toLowerCase();\n  const matches = FILE_TYPES.some((it) => {\n    return fileName.endsWith(it);\n  })\n\n  if (matches) {\n    const reader = new FileReader();\n\n    reader.readAsDataURL(file);\n\n    reader.addEventListener('load', () => {\n      if('src' in previewSelector) {\n        previewSelector.src = reader.result;\n      } else {\n        previewSelector.style.backgroundImage = `url(${reader.result})`;\n      }\n    });\n  }\n}\n\navatarFileChooser.addEventListener('change', () => {\n  onFilePreview(avatarFileChooser, avatarPreview);\n});\n\nphotoFileChooser.addEventListener('change', () => {\n  onFilePreview(photoFileChooser, photoPreview);\n});\n","/* global _:readonly */\nimport {map, renderMarkers} from './map.js';\n\nlet rents;\nconst RENTS_COUNT = 10;\nconst form = document.querySelector('.map__filters');\nconst formElements = form.querySelectorAll('.map__filter, fieldset');\nconst housingTypeSelect = form.querySelector('#housing-type');\nconst housingPriceSelect = form.querySelector('#housing-price');\nconst housingRoomsSelect = form.querySelector('#housing-rooms');\nconst housingGuestsSelect = form.querySelector('#housing-guests');\nconst housingFeaturesCheckboxList = form.querySelectorAll('.map__checkbox');\n\nconst SELECT_ANY = 'any';\n\nconst priceValues = {\n  low: 10000,\n  high: 50000,\n}\n\nconst housingPriceValues = {\n  middle: 'middle',\n  low: 'low',\n  high: 'high',\n};\n\nconst filterCallback = function () {\n  let filteredRents = [];\n  const housingRoomsValue = +housingRoomsSelect.value;\n  const housingGuestsValue = +housingGuestsSelect.value;\n\n  for (let i = 0; i < rents.length; i++) {\n    const rent = rents[i];\n\n    const features = rent.offer.features;\n    let isValidFeatures = true;\n    let price = rent.offer.price;\n\n    if (housingTypeSelect.value !== SELECT_ANY) {\n      if (rent.offer.type !== housingTypeSelect.value) {\n        continue;\n      }\n    }\n\n    if (housingPriceSelect.value !== SELECT_ANY) {\n      if (housingPriceSelect.value === housingPriceValues.middle && (price < priceValues.low || price > priceValues.high)) {\n        continue;\n      } else if (housingPriceSelect.value === housingPriceValues.low && price >= priceValues.low) {\n        continue;\n      } else if (housingPriceSelect.value === housingPriceValues.high && price <= priceValues.high) {\n        continue;\n      }\n    }\n\n    if (housingRoomsSelect.value !== SELECT_ANY) {\n      if (rent.offer.rooms !== housingRoomsValue) {\n        continue;\n      }\n    }\n\n    if (housingGuestsSelect.value !== SELECT_ANY) {\n      if (rent.offer.guests !== housingGuestsValue) {\n        continue;\n      }\n    }\n\n    housingFeaturesCheckboxList.forEach((checkbox) => {\n      if (checkbox.checked) {\n        let isValidFeature = false;\n\n        features.forEach((feature) => {\n          if (feature === checkbox.value) {\n            isValidFeature = true;\n          }\n        });\n\n        if (!isValidFeature) {\n          isValidFeatures = false;\n        }\n      }\n    });\n\n    if (!isValidFeatures) {\n      continue;\n    }\n\n    filteredRents.push(rent);\n\n    if (filteredRents.length >= RENTS_COUNT) {\n      break;\n    }\n  }\n\n  renderMarkers(filteredRents);\n}\n\nmap.on('load-all-data', (data) => {\n  rents = data.rents;\n\n  form.classList.remove('map__filters--disabled');\n  formElements.forEach((formElement) => {\n    formElement.removeAttribute('disabled');\n  });\n\n  filterCallback();\n});\n\nmap.on('adv-form-submitted', () => {\n  form.reset();\n  filterCallback();\n});\n\nlet debouncedFilterCallback =  _.debounce(filterCallback, 500);\n\nhousingTypeSelect.addEventListener('change', debouncedFilterCallback);\n\nhousingPriceSelect.addEventListener('change', debouncedFilterCallback);\n\nhousingRoomsSelect.addEventListener('change', debouncedFilterCallback);\n\nhousingGuestsSelect.addEventListener('change', debouncedFilterCallback);\n\nhousingFeaturesCheckboxList.forEach((checkbox) => {\n  checkbox.addEventListener('change', debouncedFilterCallback);\n});\n"],"sourceRoot":""}